$(document).ready(function(){var e={distance:"400"},r={name:"Peugeot 206 RC 2.0",gp:4.06,gear1:3.42,gear2:1.81,gear3:1.28,gear4:.98,gear5:.77,hp:177,weight:1150,maxrpm:7e3,kpd:0,indexkpd:18},p={name:"Ford Focus ST 2.0 EcoBoost",gp:4.06,gear1:3.42,gear2:1.81,gear3:1.28,gear4:.98,gear5:.77,hp:250,weight:1150,maxrpm:7e3,kpd:0,indexkpd:16.5},a={type:"firstCar",speed:0,gearbox:0,time:0,distance:0,rpm:750,rpmResolve:0,speedRound:0},d={type:"secondCar",speed:0,gearbox:0,time:0,distance:0,rpm:750,rpmResolve:0,speedRound:0};$.extend(a,r),$.extend(d,p),console.log(a),console.log(d);var t=function(e){0==e.gearbox&&(e.rpm=3e3),1==e.gearbox&&(e.rpmResolve=e.rpm-e.speed/(.377*.28/e.gp/e.gear2)),2==e.gearbox&&(e.rpmResolve=e.rpm-e.speed/(.377*.28/e.gp/e.gear3)),3==e.gearbox&&(e.rpmResolve=e.rpm-e.speed/(.377*.28/e.gp/e.gear4)),4==e.gearbox&&(e.rpmResolve=e.rpm-e.speed/(.377*.28/e.gp/e.gear5)),e.gearbox<5&&(e.gearbox=e.gearbox+1,"firstCar"===e.type&&o(),e.rpm=e.rpm-e.rpmResolve),console.log("up gearbox "+e.name),console.log(a),console.log(d)};$(document).keyup(function(e){38==e.keyCode&&t(a)}),$(document).keyup(function(e){39==e.keyCode&&t(d)});var o=function(){$("#gearbox b").html(a.gearbox)};o();var m=function(r){var p=setInterval(function(){r.rpm<2e3?r.kpd=r.indexkpd/1.5:r.rpm<3e3?r.kpd=r.indexkpd:r.rpm<3500?r.kpd=r.indexkpd/2.2:r.rpm<4e3?r.kpd=r.indexkpd/2.4:r.rpm<4500?r.kpd=r.indexkpd/2.6:r.rpm<5e3?r.kpd=r.indexkpd/2.4:r.rpm<5500?(r.kpd=r.indexkpd/2.2,r.gearbox<5&&"secondCar"===r.type&&t(d)):r.rpm<6e3?r.kpd=r.indexkpd/2:r.rpm<6500?r.kpd=r.indexkpd/5:r.rpm<6750||r.rpm<7e3&&(r.kpd=r.indexkpd/7),r.rpm>r.maxrpm&&(r.rpm=r.maxrpm-150),0==r.gearbox&&(r.rpm>3500&&(r.rpm=3500),r.rpm=r.rpm+r.rpm/75),1==r.gearbox&&(r.speed=.377*.28/r.gp/r.gear1*r.rpm,r.rpm=r.rpm+r.kpd*r.gp*r.gear1*2),2==r.gearbox&&(r.speed=.377*.28/r.gp/r.gear2*r.rpm,r.rpm=r.rpm+r.kpd*r.gp*r.gear2*1.7),3==r.gearbox&&(r.speed=.377*.28/r.gp/r.gear3*r.rpm,r.rpm=r.rpm+r.kpd*r.gp*r.gear3*1.4),4==r.gearbox&&(r.speed=.377*.28/r.gp/r.gear4*r.rpm,r.rpm=r.rpm+r.kpd*r.gp*r.gear4*1.1),5==r.gearbox&&(r.speed=.377*.28/r.gp/r.gear5*r.rpm,r.rpm=r.rpm+r.kpd*r.gp*r.gear5),r.time=r.time+.1,r.speedMS=.277777777777778*r.speed,r.distance=r.distance+r.speedMS/10,r.distance>e.distance&&(n(r),clearInterval(p)),c(),"firstCar"===r.type&&(r.speed<100&&$("#speed b").html(Number(r.time.toFixed(3))),s.value(r.speed),i.value(r.rpm/1e3),$("#secondCar").animate({"margin-left":25*(a.distance-d.distance)},100))},100)},n=function(e){console.log("Гонка завершена!!!!!!!, ваше время: "+Number(e.time.toFixed(3))+" - "+e.name)},g=d3.select("#speedometer").append("svg:svg").attr("width",300).attr("height",280),i=iopctrl.arcslider().radius(120).events(!1).indicator(iopctrl.defaultGaugeIndicator);i.axis().orient("in").normalize(!0).ticks(8).tickSubdivide(3).tickSize(10,8,10).tickPadding(5).scale(d3.scale.linear().domain([0,8]).range([-3*Math.PI/4,3*Math.PI/4]));var s=iopctrl.segdisplay().width(80).digitCount(6).negative(!1).decimals(0);g.append("g").attr("class","segdisplay").attr("transform","translate(130, 200)").call(s),g.append("g").attr("class","gauge").call(i),i.value(a.rpm/1e3);var c=function(){$("#tachometer b").html(Math.round(a.rpm))};$("#start").click(function(){t(a),t(d),setTimeout(function(){m(a)},20),m(d)})});